<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VVPIET - Training & Placement</title>
    <link rel="stylesheet" href="common.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#011C40">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <style>
        /* ================================
   HOME PAGE STYLES - index.html
   ================================ */

/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 3rem 20px;
    text-align: center;
}

.hero-section h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

/* Drives Grid */
.drives-section {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 20px;
}

.drives-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.drive-card {
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
    cursor: pointer;
}

.drive-card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-5px);
}

.drive-card img {
    width: 100%;
    max-width: 150px;
    height: auto;
    margin-bottom: 1rem;
}

.drive-card h3 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.drive-card p {
    margin: 0.5rem 0;
    font-size: 0.95rem;
}

/* Drive Details View */
.drive-details {
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 20px;
}

.drive-details.hidden {
    display: none;
}

.back-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    margin-bottom: 1.5rem;
    transition: var(--transition);
}

.back-btn:hover {
    background-color: var(--secondary-color);
}

.details-container {
    background: white;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: var(--shadow);
}

.details-container img.company-logo-large {
    max-width: 200px;
    margin-bottom: 1.5rem;
}

.details-container h2 {
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.detail-item {
    margin: 1.5rem 0;
}

.detail-item h3 {
    color: var(--secondary-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.students-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 1rem;
}

.student-card {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
}

.student-card img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 0.5rem;
}

/* Install Notification */
.install-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    padding: 1.5rem;
    max-width: 350px;
    z-index: 2000;
    animation: slideUp 0.3s ease;
}

.install-notification.hidden {
    display: none;
}

@keyframes slideUp {
    from {
        transform: translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.notification-content h3 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.install-steps {
    background: #f5f5f5;
    padding: 1rem;
    border-radius: 5px;
    margin: 1rem 0;
}

.install-steps ol {
    margin-left: 1.5rem;
}

.notification-buttons {
    display: flex;
    gap: 10px;
    margin-top: 1rem;
}

.btn-install {
    flex: 1;
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0.8rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}

.btn-later {
    flex: 1;
    background-color: #f0f0f0;
    border: none;
    padding: 0.8rem;
    border-radius: 5px;
    cursor: pointer;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .hero-section h1 {
        font-size: 1.8rem;
    }

    .drives-grid {
        grid-template-columns: 1fr;
    }

    .install-notification {
        bottom: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
}

@media (max-width: 480px) {
    .drives-grid {
        gap: 15px;
    }

    .drive-card {
        padding: 1rem;
    }
}


/* Add this to your existing home.css */

@media (max-width: 768px) {
    .hero-section {
        padding: 2rem 20px;
    }
    
    .hero-section h1 {
        font-size: 1.5rem;
    }
}

        </style>
</head>
<body>
    <!-- Install Notification -->
    <div id="installNotification" class="install-notification hidden">
        <div class="notification-content">
            <button class="close-btn" onclick="closeInstallNotification()">✕</button>
            <h3>Install VVPIET Placement App</h3>
            <p id="installMessage">Experience faster access with our new App technology!</p>
            <div id="installInstructions" class="install-steps">
                <!-- Instructions will be populated by JavaScript -->
            </div>
            <div class="notification-buttons">
                <button id="installBtn" class="btn-install">Install Now</button>
                <button onclick="laterInstall()" class="btn-later">Later</button>
            </div>
        </div>
    </div>

    <!-- Top Navigation Bar (Desktop Only) -->
    <nav class="navbar desktop-only">
        <div class="nav-container">
            <div class="nav-logo">VVPIET Placements</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="add-campus.html">Add Campus Drive</a></li>
                <li><a href="vvpiet.html">VVPIET</a></li>
                <li><a href="about-us.html">About Us</a></li>
            </ul>
        </div>
    </nav>

    <!-- Mobile Header -->
    <div class="mobile-header mobile-only">
        <h1>VVPIET Placements</h1>
    </div>

    <!-- Main Content -->
    <main id="mainContent">
        <section class="hero-section">
            <h1>Campus Placement Drives at VVPIET</h1>
            <p>Explore our recent placement opportunities and success stories</p>
        </section>

        <section class="drives-section">
            <div id="drivesContainer" class="drives-grid">
                <div class="loading">Loading campus drives...</div>
            </div>
        </section>
    </main>

    <!-- Drive Details View (Hidden by default) -->
    <div id="driveDetails" class="drive-details hidden">
        <button class="back-btn" onclick="goBack()">← Back</button>
        <div id="detailsContent"></div>
    </div>

    <!-- Bottom Navigation Bar (Mobile Only) -->
    <nav class="bottom-nav mobile-only">
        <a href="index.html" class="nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Home</span>
        </a>
        <a href="add-campus.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            <span>Add Drive</span>
        </a>
        <a href="vvpiet.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
            </svg>
            <span>VVPIET</span>
        </a>
        <a href="about-us.html" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>About</span>
        </a>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</body>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
// Supabase Configuration
const SUPABASE_URL = 'https://nsnacwwcrszpjmanskti.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zbmFjd3djcnN6cGptYW5za3RpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTg2MTIsImV4cCI6MjA2ODQ5NDYxMn0.W01JADzAuGFvcAHAN6LPRIxc75J7A9Q76HIxvxkJDn4';

let supabase;
let deferredPrompt;
let currentDriveId = null;

// Initialize Supabase
function initializeSupabase() {
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log("Supabase initialized successfully");
        return true;
    } catch (error) {
        console.error("Error initializing Supabase:", error);
        return false;
    }
}

// Get Image URL from Storage Path
function getImageUrl(path) {
    if (!path) return null;
    
    if (path.startsWith('http://') || path.startsWith('https://')) {
        return path;
    }
    
    return supabase.storage.from('company-logos').getPublicUrl(path).data.publicUrl;
}

// Load Campus Drives
async function loadCampusDrives() {
    const container = document.getElementById('drivesContainer');
    
    try {
        const { data, error } = await supabase
            .from('campus_drives')
            .select('*')
            .order('organized_date', { ascending: false });

        if (error) throw error;

        if (data.length === 0) {
            container.innerHTML = '<p class="loading">No campus drives found. Add your first drive!</p>';
            return;
        }

        container.innerHTML = data.map(drive => {
            const logoUrl = getImageUrl(drive.company_logo);
            
            return `
                <div class="drive-card" onclick="viewDriveDetails('${drive.id}')">
                    ${logoUrl ? `<img src="${logoUrl}" alt="${drive.company_name}">` : ''}
                    <h3>${drive.company_name}</h3>
                    ${drive.job_post ? `<p><strong>Position:</strong> ${drive.job_post}</p>` : ''}
                    ${drive.students_selected ? `<p><strong>Students Selected:</strong> ${drive.students_selected}</p>` : ''}
                    ${drive.organized_date ? `<p><strong>Date:</strong> ${new Date(drive.organized_date).toLocaleDateString()}</p>` : ''}
                </div>
            `;
        }).join('');

    } catch (error) {
        console.error('Error loading drives:', error);
        container.innerHTML = '<p class="loading">Error loading campus drives. Please try again.</p>';
    }
}

// View Drive Details
async function viewDriveDetails(driveId) {
    currentDriveId = driveId;
    
    try {
        const { data, error } = await supabase
            .from('campus_drives')
            .select('*')
            .eq('id', driveId)
            .single();

        if (error) throw error;

        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('driveDetails').classList.remove('hidden');

        let detailsHTML = '<div class="details-container">';
        
        if (data.company_logo) {
            const logoUrl = getImageUrl(data.company_logo);
            detailsHTML += `<img src="${logoUrl}" alt="${data.company_name}" class="company-logo-large">`;
        }
        
        detailsHTML += `<h2>${data.company_name}</h2>`;
        
        if (data.about_company) {
            detailsHTML += `<div class="detail-item"><h3>About Company</h3><p>${data.about_company}</p></div>`;
        }
        
        if (data.company_location) {
            detailsHTML += `<div class="detail-item"><h3>Location</h3><p>${data.company_location}</p></div>`;
        }
        
        if (data.job_post) {
            detailsHTML += `<div class="detail-item"><h3>Job Position</h3><p>${data.job_post}</p></div>`;
        }
        
        if (data.students_selected) {
            detailsHTML += `<div class="detail-item"><h3>Students Selected</h3><p>${data.students_selected}</p></div>`;
        }
        
        if (data.students_data && data.students_data.length > 0) {
            detailsHTML += '<div class="detail-item"><h3>Selected Students</h3><div class="students-list">';
            data.students_data.forEach(student => {
                detailsHTML += '<div class="student-card">';
                if (student.image) {
                    detailsHTML += `<img src="${student.image}" alt="${student.name}">`;
                }
                detailsHTML += `<h4>${student.name}</h4>`;
                if (student.package) {
                    detailsHTML += `<p><strong>Package:</strong> ${student.package}</p>`;
                }
                detailsHTML += '</div>';
            });
            detailsHTML += '</div></div>';
        }
        
        if (data.organized_date) {
            detailsHTML += `<div class="detail-item"><h3>Date of Drive</h3><p>${new Date(data.organized_date).toLocaleDateString()}</p>`;
        }
        
        if (data.custom_fields && data.custom_fields.length > 0) {
            data.custom_fields.forEach(field => {
                detailsHTML += `<div class="detail-item"><h3>${field.field_name}</h3><p>${field.field_value}</p></div>`;
            });
        }
        
        detailsHTML += '</div>';
        
        document.getElementById('detailsContent').innerHTML = detailsHTML;
        
        history.pushState({ driveId }, '', `#drive-${driveId}`);
        
    } catch (error) {
        console.error('Error loading drive details:', error);
        alert('Error loading drive details');
    }
}

// Go Back Function
function goBack() {
    document.getElementById('driveDetails').classList.add('hidden');
    document.getElementById('mainContent').style.display = 'block';
    currentDriveId = null;
    history.pushState({}, '', 'index.html');
}

// Handle browser back button
window.addEventListener('popstate', (event) => {
    if (currentDriveId) {
        goBack();
    }
});

// Detect Device and Browser
function getDeviceInfo() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
    // iOS detection
    const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
    const isIPad = /iPad/.test(userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    
    // Android detection
    const isAndroid = /android/i.test(userAgent);
    
    // Windows detection
    const isWindows = /Windows/.test(userAgent);
    
    // Chrome detection
    const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
    
    // Safari detection
    const isSafari = /Safari/.test(userAgent) && /Apple Computer/.test(navigator.vendor);
    
    // Edge detection
    const isEdge = /Edg/.test(userAgent);
    
    return {
        isIOS: isIOS || isIPad,
        isAndroid,
        isWindows,
        isChrome,
        isSafari,
        isEdge,
        isMobile: isIOS || isIPad || isAndroid
    };
}

// Show Install Instructions based on Device
function showInstallInstructions(device) {
    const instructionsDiv = document.getElementById('installInstructions');
    const installBtn = document.getElementById('installBtn');
    const installMessage = document.getElementById('installMessage');
    
    let instructions = '';
    
    if (device.isIOS) {
        // iOS - Safari only
        installMessage.textContent = 'Add this app to your home screen for a better experience!';
        instructions = `
            <p><strong>How to Install on iOS:</strong></p>
            <ol>
                <li>Tap the Share button <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"/></svg> at the bottom</li>
                <li>Scroll and tap "Add to Home Screen"</li>
                <li>Tap "Add" in the top right</li>
            </ol>
        `;
        installBtn.style.display = 'none'; // Hide install button for iOS
        
    } else if (device.isAndroid) {
        installMessage.textContent = 'Install this app for faster access and offline use!';
        instructions = `
            <p><strong>How to Install on Android:</strong></p>
            <ol>
                <li>Tap "Install Now" button below, OR</li>
                <li>Tap the menu (⋮) in Chrome</li>
                <li>Select "Add to Home screen" or "Install app"</li>
                <li>Tap "Install"</li>
            </ol>
        `;
        installBtn.style.display = 'block';
        
    } else if (device.isWindows) {
        installMessage.textContent = 'Install this app on your desktop for quick access!';
        instructions = `
            <p><strong>How to Install on Windows:</strong></p>
            <ol>
                <li>Click "Install Now" button below, OR</li>
                <li>Click the install icon (⊕) in the address bar</li>
                <li>Click "Install"</li>
            </ol>
        `;
        installBtn.style.display = 'block';
        
    } else {
        // Default for other devices
        installMessage.textContent = 'Install this app for a better experience!';
        instructions = `
            <p><strong>How to Install:</strong></p>
            <ol>
                <li>Click "Install Now" button below</li>
                <li>Or look for the install icon in your browser</li>
            </ol>
        `;
        installBtn.style.display = 'block';
    }
    
    instructionsDiv.innerHTML = instructions;
}

// PWA Install Notification - Enhanced for all platforms
function showInstallNotification() {
    const installDismissed = localStorage.getItem('installDismissed');
    const dismissDate = localStorage.getItem('installDismissDate');
    
    // Check if user dismissed with "Later" within last day
    if (installDismissed === 'later' && dismissDate) {
        const daysSince = (Date.now() - parseInt(dismissDate)) / (1000 * 60 * 60 * 24);
        if (daysSince < 1) return;
    }
    
    // Don't show if user permanently dismissed
    if (installDismissed === 'never') return;
    
    // Don't show if already installed (for Android/Desktop)
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
        return;
    }
    
    const device = getDeviceInfo();
    showInstallInstructions(device);
    
    // Show notification after 2 seconds
    setTimeout(() => {
        document.getElementById('installNotification').classList.remove('hidden');
    }, 2000);
}

// beforeinstallprompt event (Android/Chrome/Edge)
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    console.log('beforeinstallprompt fired');
    showInstallNotification();
});

// Install Button Click Handler
document.getElementById('installBtn')?.addEventListener('click', async () => {
    const device = getDeviceInfo();
    
    if (deferredPrompt) {
        // For Android/Chrome/Windows
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        console.log(`User choice: ${outcome}`);
        
        if (outcome === 'accepted') {
            localStorage.setItem('installDismissed', 'installed');
        }
        
        deferredPrompt = null;
        document.getElementById('installNotification').classList.add('hidden');
    } else if (device.isIOS) {
        // For iOS - just close the notification as instructions are shown
        alert('Please follow the instructions above to install the app');
    } else {
        // Fallback - show instructions
        alert('Please use your browser\'s menu to install this app');
    }
});

function laterInstall() {
    localStorage.setItem('installDismissed', 'later');
    localStorage.setItem('installDismissDate', Date.now().toString());
    document.getElementById('installNotification').classList.add('hidden');
}

function closeInstallNotification() {
    if (confirm('Are you sure you don\'t want to install? You can always install later from your browser menu.')) {
        localStorage.setItem('installDismissed', 'never');
        document.getElementById('installNotification').classList.add('hidden');
    }
}

// Check if app was installed
window.addEventListener('appinstalled', () => {
    console.log('PWA was installed');
    localStorage.setItem('installDismissed', 'installed');
    document.getElementById('installNotification').classList.add('hidden');
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    if (initializeSupabase()) {
        loadCampusDrives();
    }
    
    // Show install notification for all platforms
    // Wait a bit for page to load
    setTimeout(() => {
        showInstallNotification();
    }, 1000);
});

// Register Service Worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Service Worker registered'))
        .catch(err => console.error('Service Worker registration failed:', err));
}
    </script>
</body>
</html>
